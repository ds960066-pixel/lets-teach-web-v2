<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lets Teach | Find Teachers & Institutes</title>

  <meta name="description"
        content="Browse verified teachers & institutes. Login only for actions (invite, chat, job apply). Lets Teach is a free public platform for education hiring." />

  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- NAV -->
  <div class="nav">
    <div class="container navInner">
      <div class="brand">
        <div class="logo"></div>
        <div>Lets Teach</div>
      </div>

      <div class="navLinks">
        <a class="pill" href="jobs.html">Jobs</a>
        <a class="pill" href="interview/index.html">Interview Prep</a>
        <a class="pill" href="login.html">Login</a>
      </div>
    </div>
  </div>

  <div class="container">

    <!-- HERO -->
    <div class="hero heroGrid">
      <div>
        <h1 class="hTitle">Find teachers & institutes in your city.</h1>
        <p class="hSub">
          Public browsing is open. <b>Login only when you want to take action</b>
          (send invite, chat, apply job).
        </p>

        <div class="card cardPad">
          <div class="sectionTitle">Search (Public)</div>

          <div class="searchGrid">
            <input class="input" id="city" placeholder="City (e.g. Patna, Delhi)" autocomplete="off" />
            <input class="input" id="subject" placeholder="Subject (e.g. Math, English)" autocomplete="off" />
            <button class="btn" onclick="applyFilter()">Search</button>
          </div>

          <div class="kpis">
            <div class="kpi">
              <b id="kpiTeachers">‚Äî</b>
              <span>Teachers shown</span>
            </div>
            <div class="kpi">
              <b id="kpiInstitutes">‚Äî</b>
              <span>Institutes shown</span>
            </div>
            <div class="kpi">
              <b>Secure</b>
              <span>Chat unlocks after invite accept</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card cardPad">
        <div class="sectionTitle">How it works</div>
        <div class="meta">
          ‚úÖ Browse teachers/institutes without login<br>
          üîí Invite / Chat requires login<br>
          üßæ Resume required before job apply (teacher)<br>
          üõ°Ô∏è Safety: blocked users are hidden
        </div>

        <hr class="sep">

        <div class="sectionTitle">Quick links</div>
        <div class="meta">
          ‚Ä¢ <a class="smallLink" href="teacher.html">Browse Teachers</a><br>
          ‚Ä¢ <a class="smallLink" href="institutes.html">Browse Institutes</a><br>
          ‚Ä¢ <a class="smallLink" href="jobs.html">Browse Jobs</a>
        </div>
      </div>
    </div>

    <hr class="sep">

    <!-- RESULTS -->
    <div class="grid2">

      <!-- Teachers -->
      <div class="card cardPad">
        <div class="sectionTitle">Verified Teachers</div>
        <ul class="list" id="teachers"></ul>
      </div>

      <!-- Institutes -->
      <div class="card cardPad">
        <div class="sectionTitle">Verified Institutes</div>
        <ul class="list" id="institutes"></ul>
      </div>

    </div>

    <div class="footer">
      ¬© <span id="year"></span> Lets Teach ‚Ä¢ Built for public discovery + safe actions
    </div>

  </div>

<script>
const BASE_URL = "https://express-hello-world-uh96.onrender.com";

document.getElementById("year").innerText = new Date().getFullYear();

/* ===== APPLY FILTER ===== */
function applyFilter(){
  const city = document.getElementById("city").value.trim();
  const subject = document.getElementById("subject").value.trim();

  loadTeachers(city, subject);
  loadInstitutes(city);
}

/* ===== LOAD VERIFIED TEACHERS (PUBLIC) ===== */
async function loadTeachers(city="", subject=""){
  const ul = document.getElementById("teachers");
  ul.innerHTML = `<li class="item"><div>Loading...</div><span class="badge">Please wait</span></li>`;

  try{
    let url = `${BASE_URL}/api/teacher/public`;
    const params = [];
    if(city) params.push(`city=${encodeURIComponent(city)}`);
    if(subject) params.push(`subject=${encodeURIComponent(subject)}`);
    if(params.length) url += `?${params.join("&")}`;

    const res = await fetch(url);
    const data = await res.json();

    ul.innerHTML = "";

    const teachers = data.teachers || [];
    document.getElementById("kpiTeachers").innerText = teachers.length;

    if(!teachers.length){
      ul.innerHTML = `<li class="item"><div>No verified teachers found</div><span class="badge">Public</span></li>`;
      return;
    }

    teachers.slice(0, 20).forEach(t=>{
      const li = document.createElement("li");
      li.className = "item";
      li.innerHTML = `
        <div>
          <div><b>${escapeHtml(t.name)}</b> <span class="badge">Verified</span></div>
          <div class="meta">${escapeHtml(t.subject)} ‚Ä¢ ${escapeHtml(t.city)} ‚Ä¢ ${Number(t.experience || 0)} yrs</div>
          <div class="meta">
            <a class="smallLink" href="teacher-public.html?uid=${encodeURIComponent(t.uid)}">View profile</a>
            &nbsp;‚Ä¢&nbsp;
            <a class="smallLink" href="login.html">Invite / Chat</a>
          </div>
        </div>
        <div class="badge">Teacher</div>
      `;
      ul.appendChild(li);
    });
  }catch(e){
    ul.innerHTML = `<li class="item"><div>Error loading teachers</div><span class="badge">Retry</span></li>`;
    document.getElementById("kpiTeachers").innerText = "‚Äî";
  }
}

/* ===== LOAD VERIFIED INSTITUTES (PUBLIC) ===== */
async function loadInstitutes(city=""){
  const ul = document.getElementById("institutes");
  ul.innerHTML = `<li class="item"><div>Loading...</div><span class="badge">Please wait</span></li>`;

  try{
    let url = `${BASE_URL}/api/institute/browse`;
    if(city) url += `?city=${encodeURIComponent(city)}`;

    const res = await fetch(url);
    const data = await res.json();

    ul.innerHTML = "";

    const institutes = data.institutes || [];
    document.getElementById("kpiInstitutes").innerText = institutes.length;

    if(!institutes.length){
      ul.innerHTML = `<li class="item"><div>No verified institutes found</div><span class="badge">Public</span></li>`;
      return;
    }

    institutes.slice(0, 20).forEach(i=>{
      const subjects = (i.subjectsNeeded || []).join(", ");
      const li = document.createElement("li");
      li.className = "item";
      li.innerHTML = `
        <div>
          <div><b>${escapeHtml(i.name)}</b> <span class="badge">Verified</span></div>
          <div class="meta">${escapeHtml(i.city)}${subjects ? " ‚Ä¢ " + escapeHtml(subjects) : ""}</div>
          <div class="meta">
            <a class="smallLink" href="institute-public.html?uid=${encodeURIComponent(i.uid)}">View profile</a>
            &nbsp;‚Ä¢&nbsp;
            <a class="smallLink" href="login.html">Invite / Chat</a>
          </div>
        </div>
        <div class="badge">Institute</div>
      `;
      ul.appendChild(li);
    });
  }catch(e){
    ul.innerHTML = `<li class="item"><div>Error loading institutes</div><span class="badge">Retry</span></li>`;
    document.getElementById("kpiInstitutes").innerText = "‚Äî";
  }
}

/* ===== small safety for UI text ===== */
function escapeHtml(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ===== initial load ===== */
loadTeachers();
loadInstitutes();
</script>

</body>
</html>
