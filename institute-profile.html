<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Institute Profile | Lets Teach</title>

  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <!-- NAV -->
  <div class="nav">
    <div class="container navInner">
      <div class="brand">
        <div class="logo"></div>
        <div>Lets Teach</div>
      </div>

      <div class="navLinks">
        <a class="pill" href="index.html">Home</a>
        <a class="pill" href="jobs.html">Jobs</a>
        <a class="pill" href="login.html">Login</a>
      </div>
    </div>
  </div>

  <div class="container">

    <div class="card cardPad" style="max-width: 720px; margin: 0 auto;">
      <div style="display:flex;justify-content:space-between;gap:12px;align-items:flex-start;flex-wrap:wrap;">
        <div>
          <h1 id="name" style="margin:0 0 6px;">Loading...</h1>
          <div class="meta" id="metaLine">Fetching institute details...</div>
        </div>
        <span class="badge" id="statusBadge">Institute</span>
      </div>

      <hr class="sep" />

      <div class="grid2">
        <div class="kpi">
          <b>City</b>
          <span id="city">—</span>
        </div>
        <div class="kpi">
          <b>Address</b>
          <span id="address">—</span>
        </div>
      </div>

      <div class="sectionTitle">Subjects Needed</div>
      <ul id="subjects" class="list"></ul>

      <hr class="sep" />

      <div class="kpi" style="background:rgba(59,130,246,.10);border:1px solid rgba(59,130,246,.28);">
        <b>Interested in this institute?</b>
        <span style="display:block;margin-top:6px;">
          Invite / Chat ke liye teacher login/register required.
        </span>

        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">
          <button class="btn" onclick="goLogin()">Login / Register</button>
          <a class="pill" href="index.html">Back to Search</a>
        </div>
      </div>
    </div>

    <div class="footer">
      <a href="privacy.html">Privacy</a> ·
      <a href="interview/index.html">Interview Preps</a>
    </div>

  </div>

<script>
const BASE_URL = "https://express-hello-world-uh96.onrender.com";
const params = new URLSearchParams(window.location.search);
const instituteUid = params.get("uid");

if (!instituteUid) {
  alert("Invalid profile (UID missing)");
  window.location.href = "index.html";
}

/* ================= HELPERS ================= */
function escapeHtml(str) {
  return String(str || "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function goLogin() {
  window.location.href = "login.html";
}

/* ================= LOAD INSTITUTE PROFILE ================= */
fetch(`${BASE_URL}/api/institute/${encodeURIComponent(instituteUid)}`)
  .then(res => res.json())
  .then(data => {
    // backend response: { success:true, institute } OR { success:false, message }
    const i = data && (data.institute || (data.success && data.institute));
    if (!i) {
      alert(data?.message || "Institute not found");
      window.location.href = "index.html";
      return;
    }

    document.getElementById("name").innerText = i.name || "Institute";
    document.getElementById("city").innerText = i.city || "—";
    document.getElementById("address").innerText = i.address || "Not provided";

    // meta line
    const subjectsTxt = Array.isArray(i.subjectsNeeded) && i.subjectsNeeded.length
      ? i.subjectsNeeded.join(", ")
      : "No subjects listed";
    document.getElementById("metaLine").innerText = `UID: ${i.uid || instituteUid} · ${subjectsTxt}`;

    // subjects list
    const ul = document.getElementById("subjects");
    ul.innerHTML = "";

    if (Array.isArray(i.subjectsNeeded) && i.subjectsNeeded.length > 0) {
      i.subjectsNeeded.forEach(s => {
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `
          <div>
            <div class="itemTitle">${escapeHtml(s)}</div>
            <div class="meta">Required subject</div>
          </div>
          <span class="badge">Needed</span>
        `;
        ul.appendChild(li);
      });
    } else {
      const li = document.createElement("li");
      li.className = "item";
      li.innerHTML = `
        <div>
          <div class="itemTitle">No subjects listed</div>
          <div class="meta">Institute ne abhi subjects add nahi kiye</div>
        </div>
        <span class="badge">—</span>
      `;
      ul.appendChild(li);
    }
  })
  .catch(() => {
    alert("Failed to load profile (server error)");
    window.location.href = "index.html";
  });
</script>

</body>
</html>
