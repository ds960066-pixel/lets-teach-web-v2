<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Institute Dashboard | Lets Teach</title>

  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; margin: 0; }
    .card { background: #fff; padding: 15px; margin-bottom: 12px; border-radius: 6px; }
    button { padding: 6px 12px; background: #2e86de; color: #fff; border: none; cursor: pointer; border-radius: 4px; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    input, select, textarea { width: 100%; max-width: 520px; padding: 8px; margin: 6px 0; border: 1px solid #ddd; border-radius: 4px; }
    textarea { min-height: 80px; }
    .warn { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; padding: 10px; border-radius: 6px; }
    .ok { background: #eafaf1; color: #1e7e34; border: 1px solid #c3e6cb; padding: 10px; border-radius: 6px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    .row > div { flex: 1; min-width: 200px; }
  </style>
</head>

<body>

<script>
/* ================= AUTH GUARD ================= */
if (!localStorage.uid || localStorage.role !== "institute") {
  window.location.href = "login.html";
}
</script>

<h2>Institute Dashboard</h2>
<button onclick="logout()">Logout</button>
<hr>

<!-- ================= STATUS ================= -->
<div class="card">
  <div id="phoneStatusBox" class="ok">
    ✅ Phone verification temporarily disabled. You can post jobs.
  </div>
</div>

<!-- ================= CREATE JOB ================= -->
<div class="card">
  <h3>Create Job</h3>

  <div class="row">
    <div>
      <label>Job Title *</label>
      <input id="jobTitle" placeholder="e.g. Maths Teacher" />
    </div>
    <div>
      <label>City *</label>
      <input id="jobCity" placeholder="e.g. Delhi" />
    </div>
  </div>

  <div class="row">
    <div>
      <label>Subject *</label>
      <input id="jobSubject" placeholder="e.g. Maths" />
    </div>
    <div>
      <label>Role</label>
      <select id="jobRole">
        <option value="both">Both</option>
        <option value="part-time">Part-time</option>
        <option value="full-time">Full-time</option>
      </select>
    </div>
  </div>

  <label>Salary</label>
  <input id="jobSalary" placeholder="e.g. 15000-25000" />

  <label>Description</label>
  <textarea id="jobDescription" placeholder="Timing, requirements..."></textarea>

  <button id="postJobBtn" onclick="postJob()">Post Job</button>

  <div id="jobResult" style="margin-top:10px;"></div>
</div>

<script>
const BASE_URL = "https://express-hello-world-uh96.onrender.com";
const uid = localStorage.getItem("uid");

/* ================= LOGOUT ================= */
function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}

/* ================= POST JOB ================= */
async function postJob() {
  const title = document.getElementById("jobTitle").value.trim();
  const city = document.getElementById("jobCity").value.trim();
  const subject = document.getElementById("jobSubject").value.trim();
  const role = document.getElementById("jobRole").value;
  const salary = document.getElementById("jobSalary").value.trim();
  const description = document.getElementById("jobDescription").value.trim();

  if (!title || !city || !subject) {
    alert("Title, City and Subject required");
    return;
  }

  const btn = document.getElementById("postJobBtn");
  btn.disabled = true;
  btn.innerText = "Posting...";

  try {
    const res = await fetch(`${BASE_URL}/api/job/create`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        instituteUid: uid,
        title,
        subject,
        city,
        role,
        salary,
        description
      })
    });

    const data = await res.json();

    if (!res.ok || !data.success) {
      document.getElementById("jobResult").innerHTML =
        `<div class="warn">${data.message || "Failed"}</div>`;
      return;
    }

    document.getElementById("jobResult").innerHTML =
      `<div class="ok">✅ Job posted successfully</div>`;

    document.getElementById("jobTitle").value = "";
    document.getElementById("jobCity").value = "";
    document.getElementById("jobSubject").value = "";
    document.getElementById("jobSalary").value = "";
    document.getElementById("jobDescription").value = "";

  } catch (e) {
    document.getElementById("jobResult").innerHTML =
      `<div class="warn">Server error</div>`;
  } finally {
    btn.disabled = false;
    btn.innerText = "Post Job";
  }
}
</script>

</body>
</html>
